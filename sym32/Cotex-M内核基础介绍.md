### 主流嵌入式处理器内核
1. 简介
	1. 哈佛结构 指令总线与数据总线独立
	2. 32位内核 32位数据总线 32位指令总线 32位地址总线 32位寄存器
	3. Thumb-2 16位指令与32位指令
	4. 结构图![[Pasted image 20230627132119.png]]
2. 内核寄存器组
	1. 常用寄存器![[Pasted image 20230627132203.png]]
	2. SP最低两位永远是零，这表示永远是4字节对齐的。
	3. 异常exception 凡是大端程序顺序执行的事件都被称作异常
	4. ![[Pasted image 20230628095854.png]]
	5. 特殊功能寄存器![[Pasted image 20230627132303.png]]
	6. ![[Pasted image 20230627133750.png]]
	7. 主堆栈指针（ MSP）， 或写作 SP_main。这是缺省的堆栈指针，它由 OS 内核、异常服务例程  以及所有需要特权访问的应用程序代码来使用。  进程堆栈指针（ PSP）， 或写作 SP_process。用于常规的应用程序代码（不处于异常服用例  
	8. 特殊功能器组 只能使用 MSR /MRS指令访问
	9. ![[Pasted image 20230627134539.png]]
	10. ![[Pasted image 20230627134553.png]]
	11. ![[Pasted image 20230627134625.png]]
	12. 这三个寄存器只有在priveleged模式下才可以访问![[Pasted image 20230627134653.png]]
	13. ![[Pasted image 20230628130849.png]]
程中时）。
3. 操作模式和特权级别
	1. 操作模式
		1. handler model
		2. thread model
	2. 特权级别
		1. privileged
		2. unprivileged
	![[Pasted image 20230628131648.png]]
	3. 在 CM3 运行主应用程序时（线程模式），既可以使用特权级，也可以使用用户级；但是异常服 务例程必须在特权级下执行。复位后，处理器默认进入线程模式
	4. ![[Pasted image 20230627132812.png]]
	5. ![[Pasted image 20230627135320.png]]
1. NVIC
	1. 简介
		1. 可中断嵌套
		2. 向量中断支持
		3. 动态优先级调整
		4. 中断可屏蔽
2. 存储器映射![[Pasted image 20230627133155.png]]
3. 总线接口
4. 存储单元保护
5. 指令集合 Thumb-2
6. 中断与异常
	1. 256个预定义的异常类型![[Pasted image 20230627133616.png]]
### 复位序列
1. ![[Pasted image 20230627140512.png]]
2. ![[Pasted image 20230628123656.png]]
3. 指令 BL function = PC  <-function    LR<-主函数的下一条指令地址
4. BX LR  =  PC <-LR
5. 尽管 PC 的 LSB 总是 0（因为代码至少是字对齐的)， LR 的 LSB 却是可读可写的。这是历史遗留  的产物。在以前，由位 0 来指示 ARM/Thumb 状态。因为其它有些 ARM 处理器支持 ARM 和 Thumb  状态并存，为了方便汇编程序移植， CM3 需要允许 LSB 可读可写
6. 如果向 PC 中写数据，就会引起一次程序的分支（但是不更新 LR 寄存器）。 CM3 中的指令至少  是半字对齐的，所以 PC 的 LSB 总是读回 0。然而， 在分支时，无论是直接写 PC 的值还是使用分支  指令， 都必须保证加载到 PC 的数值是奇数（即 LSB=1），用以表明这是在 Thumb 状态下执行。倘  若写了 0，则视为企图转入 ARM 模式， CM3 将产生一个 fault 异常
7. ![[Pasted image 20230628140008.png]]