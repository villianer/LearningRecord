
### CAN 是什么
1. Controller Area Network 是ISO国际标准化的串行通信协议
2. 广泛应用于汽车产业中，安全性 低成本 1986年德国电气商博世开发出了面向汽车的CAN通信协议，现在已经是欧洲汽车网络的标准协议
3. CAN控制器根据两根线上的点位差来判断总线电平，即差分电平。
### CAN 的特点
1. 多主控制
	1.  在总线空闲时，所有的单元都可开始发送消息
	2. 最先访问总线的单元可以获得发送权
	3. 多个单元同时开始发送时，发送高优先级ID消息的单元可获得发送权
2. 消息发送
	1.  在CAN协议中，所有的消息都以固定的格式发送。总线空闲时，所有与总线相连接的单元都可以开始发送新消息，两个以上的单元同时开始发送消息时，根据标识符决定优先级。ID并不表示发送的目的地址，而是表示访问总线的消息的优先级。两个以上的单元同时开始发送消息时，对各消息ID的每个位进行逐个仲裁比较。仲裁获胜的单元可继续发送消息，仲裁失利的单元则立刻停止发送而进行接收工作。
3. 系统的柔软性
	1. 与总线相连的单元没有类似于地址的信息，因此在总线上增加单元时，链接在总线上的其他单元的软硬件以及应用层都不需要改变。
4. 通信速度
	1. 在同一网络中，所有的单元必须设定成统一的通信速度。
5. 远程数据请求
	可通过发送“遥控帧”请求其他单元发送数据
6. 错误检测功能 错误通知功能 错误恢复功能
	所有的单元都可以检测错误（错误检测功能）
	检测出错误的单元会立即同时通知其他所有单元（错误通知功能）
	正在发送消息的单元一旦检测出错误，会强制结束当前的发送，强制结束发送的单元会不断发怒地重新发送此消息知道成功发送为止（错误恢复功能）
7. 故障封闭
	1. CAN可以判断出错误的类型是总线上暂时的数据错误（如外部噪声）还是持续的数据错误（如单元内部故障、驱动器故障、断线等）.由此功能，当总线上发生持续数据错误时，可将引起此故障的单元从总线上隔离出去
8. 链接
	CAN总线可同时链接多个单元总线，可链接的单元总数理论上没有限制，但是实际上可链接的单元数受总线上的时间延迟以及电器负载的限制，降低通信速度，可连接的单元数增加，提高通信速度，则可链接的单元数减小。
### 错误
1. 错误状态：单元始终处于3种状态之一
	1. 主动错误
	2. 被动错误
	3. 总线关闭
### CAN协议的基本概念
![](https://private-warehouse-1317335037.cos.ap-guangzhou.myqcloud.com/Test/Screenshot%202023-06-05%20144449.png)
![](https://private-warehouse-1317335037.cos.ap-guangzhou.myqcloud.com/Test/Screenshot%202023-06-05%20144725.png)

### CAN协议及标准格式
1. ISO表转化协议ISO11898和ISO11519-2
	1. ISO11898 通信速度125kbps-1Mbps
	2. ISO11519-2 125kbps以下
### CAN协议
1. 帧的种类
	1. 数据帧：用于发送单元向接收单元传送数据的帧
	2. 遥控帧：用于接收单元向具有相同ID的发送单元请求数据的帧
	3. 错误帧：用于当检测出错误时向其他单元通知错误的帧
	4. 过载帧： 用于接收单元通知其尚未做好接收准备的帧
	5. 帧间隔：用于将数据帧以及遥控帧与前面的帧分离开来的帧
2. 数据帧
数据帧由7个段组成
1. 帧起始：表示数据帧开始的段
2. 仲裁段：表示该帧优先级的段
3. 控制段：表示数据的字节数及保留位的段
4. 数据段：0-8个字节的数据
5. CRC段：检查帧的传输错误的段
6. ACK段：表示正常接收的段
7. 帧结束：表示数据帧结束的段